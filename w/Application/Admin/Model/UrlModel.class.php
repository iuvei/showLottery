<?php
 namespace Admin\Model; use Think\Model; class UrlModel extends Model { protected $_validate = array( array('url', 'url', 'URL格式不正确', self::MUST_VALIDATE, 'regex', self::MODEL_BOTH), array('short', 'url', 'URL格式不正确', self::VALUE_VALIDATE, 'regex', self::MODEL_BOTH), ); protected $_auto = array( array('status', 1, self::MODEL_INSERT, 'string'), array('create_time', 'time', self::MODEL_BOTH, 'function'), ); public function update($data){ $data = empty($data) ? $_POST : $data; $data = $this->create($data); if(empty($data)){ return false; } $info = $this->getByUrl($data['url']); if(!empty($info)){ return $info; } if(empty($data['id'])){ $id = $this->add(); $data['id'] = $id; if(!$id){ $this->error = '新增链接出错！'; return false; } } else { $status = $this->save(); if(false === $status){ $this->error = '更新链接出错！'; return false; } } return $data; } } 