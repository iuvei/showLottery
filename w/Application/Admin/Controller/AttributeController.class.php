<?php
 namespace Admin\Controller; class AttributeController extends AdminController { public function index(){ $model_id = I('get.model_id'); $map['model_id'] = $model_id; $list = $this->lists('Attribute', $map); int_to_string($list); Cookie('__forward__', $_SERVER['REQUEST_URI']); $this->assign('_list', $list); $this->assign('model_id', $model_id); $this->meta_title = '属性列表'; $this->display(); } public function add(){ $model_id = I('get.model_id'); $model = M('Model')->field('title,name,field_group')->find($model_id); $this->assign('model',$model); $this->assign('info', array('model_id'=>$model_id)); $this->meta_title = '新增属性'; $this->display('edit'); } public function edit(){ $id = I('get.id',''); if(empty($id)){ $this->error('参数不能为空！'); } $Model = M('Attribute'); $data = $Model->field(true)->find($id); if(!$data){ $this->error($Model->getError()); } $model = M('Model')->field('title,name,field_group')->find($data['model_id']); $this->assign('model',$model); $this->assign('info', $data); $this->meta_title = '编辑属性'; $this->display(); } public function update(){ $res = D('Attribute')->update(); if(!$res){ $this->error(D('Attribute')->getError()); }else{ $this->success($res['id']?'更新成功':'新增成功', Cookie('__forward__')); } } public function remove(){ $id = I('id'); empty($id) && $this->error('参数错误！'); $Model = D('Attribute'); $info = $Model->getById($id); empty($info) && $this->error('该字段不存在！'); $res = $Model->delete($id); $Model->deleteField($info); if(!$res){ $this->error(D('Attribute')->getError()); }else{ action_log('update_attribute', 'attribute', $id, UID); $this->success('删除成功', U('index','model_id='.$info['model_id'])); } } } 